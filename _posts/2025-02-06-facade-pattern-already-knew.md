---
title: "ğŸ¤” Facade? ê·¸ê±° ìš°ë¦¬ íšŒì‚¬ì—ì„œ ê·¸ëƒ¥ 'ApiService'ë¼ê³  ë¶ˆë €ëŠ”ë°"
date: 2025-02-06 23:00:00 +0900
categories: [Development, Architecture]
tags: [facade, dip, tdd, layered-architecture, kotlin]
image:
  path: /assets/img/posts/2025-02-06-cover.jpg
---

> **TL;DR** ğŸ’¡ ì‹¤ë¬´ì—ì„œ ì“°ë˜ íŒ¨í„´ì— ì´ë¦„ì´ ìˆì—ˆë‹¤. ìš©ì–´ë¥¼ ì•Œê³  ë‚˜ë‹ˆ ì„¤ëª…ì´ ì‰¬ì›Œì§€ê³ , í…ŒìŠ¤íŠ¸ë„ ì‰¬ì›Œì¡Œë‹¤.
{: .prompt-tip }

## ğŸ¤” ì´ë¯¸ í•˜ê³  ìˆì—ˆëŠ”ë°, ì´ë¦„ì„ ëª°ëë‹¤

ë¶€íŠ¸ìº í”„ ê³¼ì œë¡œ User APIë¥¼ êµ¬í˜„í•˜ë©´ì„œ Facade íŒ¨í„´ì„ ì ìš©í–ˆë‹¤. ê·¸ëŸ°ë° ì½”ë“œë¥¼ ì§œë‹¤ ë³´ë‹ˆ ì´ìƒí•˜ê²Œ ìµìˆ™í–ˆë‹¤.

> **Facade**ëŠ” í”„ë‘ìŠ¤ì–´ë¡œ "ê±´ë¬¼ì˜ ì •ë©´/ì™¸ê´€"ì´ë¼ëŠ” ëœ»ì´ë‹¤. ê±´ë¬¼ ì•ë©´ì€ ê¹”ë”í•´ ë³´ì´ì§€ë§Œ, ë’¤ì—ëŠ” ë³µì¡í•œ êµ¬ì¡°ê°€ ìˆ¨ì–´ìˆë‹¤. ë””ìì¸ íŒ¨í„´ì—ì„œë„ ê°™ì€ ì˜ë¯¸ë¡œ, ë³µì¡í•œ ì„œë¸Œì‹œìŠ¤í…œì„ ë‹¨ìˆœí•œ ì¸í„°í˜ì´ìŠ¤ë¡œ ê°ì‹¸ëŠ” ì—­í• ì„ í•œë‹¤.
{: .prompt-info }

"ì–´? ì´ê±° íšŒì‚¬ì—ì„œ ë§¨ë‚  í•˜ë˜ ê±´ë°?" ğŸ˜…

íšŒì‚¬ì—ì„œëŠ” ê·¸ëƒ¥ "ì„œë¹„ìŠ¤ ì¡°í•©í•˜ëŠ” í´ë˜ìŠ¤" ì •ë„ë¡œ ë¶ˆë €ë‹¤. `OrderFacade` ê°™ì€ ì´ë¦„ ëŒ€ì‹  `OrderApiService`, `BuyerApiService` ì´ëŸ° ì‹ìœ¼ë¡œ `XxxApiService`ë¼ê³  ë¶ˆë €ë‹¤. í•˜ëŠ” ì¼ì€ ë˜‘ê°™ì•˜ë‹¤:

- ì—¬ëŸ¬ Serviceë¥¼ ì¡°í•©
- íŠ¸ëœì­ì…˜ ê²½ê³„ ê´€ë¦¬
- DTO ë³€í™˜

ì´ì „ íšŒì‚¬ì—ì„œëŠ” Controller â†’ Service â†’ Repositoryë¡œ ë‹¨ìˆœí•˜ê²Œ ì¼ëŠ”ë°, ì§€ê¸ˆ íšŒì‚¬ì—ì„œ `XxxApiService` êµ¬ì¡°ë¥¼ ì²˜ìŒ ì ‘í–ˆë‹¤. 1ë…„ ê°€ê¹Œì´ ì´ êµ¬ì¡°ë¡œ ì½”ë“œë¥¼ ì§°ëŠ”ë°, "Facade íŒ¨í„´"ì´ë¼ëŠ” ì´ë¦„ì´ ìˆëŠ” ì¤„ ëª°ëë‹¤.

## âœ¨ ìš©ì–´ë¥¼ ì•Œê³  ë‚˜ë‹ˆ ë‹¬ë¼ì§„ ê²ƒ

### 1. ğŸ—£ï¸ ì„¤ëª…ì´ ì‰¬ì›Œì¡Œë‹¤

ì˜ˆì „ì—ëŠ” ì´ëŸ° ì‹ìœ¼ë¡œ ì„¤ëª…í–ˆë‹¤:

> "ì´ í´ë˜ìŠ¤ëŠ” Serviceë“¤ì„ ì¡°í•©í•´ì„œ Controllerì— ì „ë‹¬í•˜ëŠ” ì—­í• ì´ì—ìš”"

ì§€ê¸ˆì€:

> "ì´ê±´ Facadeì˜ˆìš”. ë³µì¡í•œ ì„œë¸Œì‹œìŠ¤í…œì„ ë‹¨ìˆœí•œ ì¸í„°í˜ì´ìŠ¤ë¡œ ê°ì‹¸ëŠ” ê±°ì£ "
{: .prompt-info }

í•œ ë‹¨ì–´ë¡œ ì˜ë„ê°€ ì „ë‹¬ëœë‹¤.

### 2. ğŸ—ï¸ êµ¬ì¡°ê°€ ëª…í™•í•´ì¡Œë‹¤

```text
Controller â†’ Facade â†’ Service â†’ Repository
```

Facadeê°€ ë­˜ í•˜ëŠ” ë ˆì´ì–´ì¸ì§€ ì´ë¦„ë§Œ ë´ë„ ì•Œ ìˆ˜ ìˆë‹¤.

### 3. ğŸ§ª í…ŒìŠ¤íŠ¸ ê²½ê³„ê°€ ë³´ì˜€ë‹¤

Facadeë¥¼ ì•Œê³  ë‚˜ë‹ˆ "ì—¬ê¸°ì„œ ë­˜ í…ŒìŠ¤íŠ¸í•´ì•¼ í•˜ì§€?"ê°€ ëª…í™•í•´ì¡Œë‹¤.

- **Service í…ŒìŠ¤íŠ¸**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (Fake Repositoryë¡œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸)
- **Facade í…ŒìŠ¤íŠ¸**: Service ì¡°í•©, DTO ë³€í™˜ (í•„ìš”í•˜ë©´)
- **E2E í…ŒìŠ¤íŠ¸**: HTTP â†’ DB ì „ì²´ íë¦„

## ğŸ”„ DIPë„ ë§ˆì°¬ê°€ì§€ì˜€ë‹¤

Repository ì¸í„°í˜ì´ìŠ¤ë¥¼ Domain ë ˆì´ì–´ì— ë‘ëŠ” êµ¬ì¡°ë„ íšŒì‚¬ì—ì„œ ì“°ë˜ ë°©ì‹ì´ì—ˆë‹¤.

```kotlin
// Domain Layer
interface UserRepository {
    fun findByLoginId(loginId: String): User?
    fun save(user: User): User
}
```
{: file="domain/UserRepository.kt" }

```kotlin
// Infrastructure Layer
class UserRepositoryImpl(
    private val jpaRepository: UserJpaRepository
) : UserRepository {
    override fun findByLoginId(loginId: String): User? =
        jpaRepository.findByLoginId(loginId)
    // ...
}
```
{: file="infra/UserRepositoryImpl.kt" }

ì˜ˆì „ì—ëŠ” "JPA ì˜ì¡´ì„± ë¶„ë¦¬í•˜ë ¤ê³  ì´ë ‡ê²Œ í•˜ëŠ” ê±°ì•¼"ë¼ê³  ì„¤ëª…í–ˆë‹¤. ì§€ê¸ˆì€ "DIP(ì˜ì¡´ì„± ì—­ì „ ì›ì¹™) ì ìš©í•œ ê±°ì•¼"ë¼ê³  ë§í•  ìˆ˜ ìˆë‹¤.

ê·¸ë¦¬ê³  ì´ êµ¬ì¡° ë•ë¶„ì— í…ŒìŠ¤íŠ¸í•  ë•Œ `FakeUserRepository`ë¥¼ ì‰½ê²Œ ë¼ì›Œë„£ì„ ìˆ˜ ìˆì—ˆë‹¤:

```kotlin
// í…ŒìŠ¤íŠ¸ìš© Fake êµ¬í˜„ì²´
class FakeUserRepository : UserRepository {
    private val storage = mutableMapOf<Long, User>()
    private var sequence = 1L

    override fun save(user: User): User {
        val id = sequence++
        val savedUser = user.copy(id = id)  // ì‹¤ì œ ì €ì¥ì²˜ëŸ¼ id ì±„ë²ˆ
        storage[id] = savedUser
        return savedUser
    }
    // ...
}
```
{: file="test/FakeUserRepository.kt" }

```kotlin
// Mock ë°©ì‹
val userRepo = mock<UserRepository>()
whenever(userRepo.findByLoginId("test")).thenReturn(User(...))
whenever(userRepo.save(any())).thenReturn(User(...))

// Fake ë°©ì‹
val userRepo = FakeUserRepository()
userRepo.save(User(...))
```

## ğŸ”¥ ì´ë²ˆ ê³¼ì œì—ì„œ ê²ªì€ ì‹¤ì œ ê³ ë¯¼

### âš ï¸ íŠ¸ëœì­ì…˜ ê²½ê³„ ë¬¸ì œ

ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ APIë¥¼ ë§Œë“¤ë©´ì„œ ì‚½ì§ˆí–ˆë‹¤. ì²˜ìŒ êµ¬ì¡°ëŠ” ì´ë¬ë‹¤:

```kotlin
// Facade
fun changePassword(loginId: String, loginPw: String, command: ChangePasswordCommand) {
    val user = userService.authenticate(loginId, loginPw)  // readOnly íŠ¸ëœì­ì…˜
    userService.changePassword(user, command)              // ë‹¤ë¥¸ íŠ¸ëœì­ì…˜
}
```
{: file="UserFacade.kt" }

> `authenticate()`ê°€ `@Transactional(readOnly = true)`ë¼ì„œ, ë°˜í™˜ëœ User ì—”í‹°í‹°ê°€ Detached ìƒíƒœê°€ ëë‹¤. ì´í›„ `changePassword()`ì—ì„œ ìˆ˜ì •í•´ë„ DBì— ë°˜ì˜ì´ ì•ˆ ëë‹¤.
{: .prompt-warning }

ê²°êµ­ Service ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ë¥¼ ë°”ê¿”ì„œ í•´ê²° âœ…

```kotlin
// Service
@Transactional
fun changePassword(loginId: String, loginPw: String, command: ChangePasswordCommand) {
    val user = findAndValidate(loginId, loginPw)  // ê°™ì€ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì¡°íšŒ
    user.changePassword(passwordEncoder.encode(command.newPassword))
    // Dirty Checkingìœ¼ë¡œ ìë™ UPDATE
}
```
{: file="UserService.kt" }

ì²˜ìŒì—” Facadeì— `@Transactional`ì„ ë¶™ì—¬ì„œ ì „ì²´ë¥¼ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì„ê¹Œ ê³ ë¯¼í–ˆë‹¤. í•˜ì§€ë§Œ Facadeê°€ íŠ¸ëœì­ì…˜ì„ ê´€ë¦¬í•˜ë©´ Service ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ê°€ ì–´ë ¤ì›Œì§ˆ ê²ƒ ê°™ì•„ì„œ, Service ë‚´ë¶€ì—ì„œ í•´ê²°í•˜ëŠ” ë°©í–¥ì„ ì„ íƒí–ˆë‹¤.

`findAndValidate()`ëŠ” `authenticate()`ì™€ ì¤‘ë³µë˜ì§€ë§Œ, private ë©”ì„œë“œë¡œ ì¶”ì¶œí•´ì„œ DRY ì›ì¹™ì€ ì§€ì¼°ë‹¤.

> ë‚˜ì¤‘ì— ì´ë²¤íŠ¸ ê¸°ë°˜ìœ¼ë¡œ í™•ì¥í•œë‹¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ì§€ëŠ” ì•„ì§ ëª¨ë¥´ê² ë‹¤. íŠ¸ëœì­ì…˜ ê²½ê³„ë¥¼ ì–´ë””ì— ë‘˜ì§€, ì´ë²¤íŠ¸ ë°œí–‰ ì‹œì ì€ ì–¸ì œë¡œ í• ì§€ ë“± ê³ ë¯¼ì´ ë” í•„ìš”í•  ê²ƒ ê°™ë‹¤.
{: .prompt-info }

### ğŸ”’ ë§ˆìŠ¤í‚¹ ë¡œì§ ìœ„ì¹˜

ì´ë¦„ ë§ˆìŠ¤í‚¹ì„ ì–´ë””ì— ë‘˜ì§€ë„ ê³ ë¯¼ì´ì—ˆë‹¤. "í™ê¸¸ë™" â†’ "í™ê¸¸*" ë³€í™˜í•˜ëŠ” ë¡œì§ì¸ë°:

- **Aì•ˆ**: Controller/DTOì—ì„œ ì²˜ë¦¬
- **Bì•ˆ**: Facade/Application Layerì—ì„œ ì²˜ë¦¬
- **Cì•ˆ**: Entityì— ë©”ì„œë“œë¡œ ì •ì˜

ê²°êµ­ Cì•ˆì„ ì„ íƒí–ˆë‹¤ ğŸ‘‡

```kotlin
// User ì—”í‹°í‹°
fun maskedName(): String = if (name.length <= 1) "*" else name.dropLast(1) + "*"
```
{: file="User.kt" }

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Presentation Layer (Controller, DTO)           â”‚  â† Aì•ˆ: ì—¬ê¸°ì„œ ë§ˆìŠ¤í‚¹?
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Application Layer (Facade, UserInfo)           â”‚  â† Bì•ˆ: ì—¬ê¸°ì„œ ë§ˆìŠ¤í‚¹?
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Domain Layer (Entity, Service)                 â”‚  â† Cì•ˆ: ì—¬ê¸°ì„œ ë§ˆìŠ¤í‚¹? âœ…
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Infrastructure Layer (Repository, JPA)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
{: file="Layered Architecture" }

"í‘œí˜„ ë°©ì‹"ì´ë‹ˆê¹Œ ìœ„ìª½ ë ˆì´ì–´ì— ë‘˜ ìˆ˜ë„ ìˆì§€ë§Œ, "ì™¸ë¶€ì— ì´ë¦„ì„ ì–´ë–»ê²Œ ë³´ì—¬ì¤„ì§€"ëŠ” User ë„ë©”ì¸ì´ ì•Œì•„ì•¼ í•  ì§€ì‹ì´ë¼ê³  íŒë‹¨í•´ì„œ Entityì— ë’€ë‹¤. ì •ë‹µì¸ì§€ëŠ” ëª¨ë¥´ê² ì§€ë§Œ.

## ğŸ“ ë°°ìš´ ì 

> ì•ì€ ì‘ì€ ëª¨ë¦„ì—ì„œ í° ëª¨ë¦„ìœ¼ë¡œ ë‚˜ì•„ê°€ëŠ” ê³¼ì •ì´ë‹¤.

"ê·¸ëƒ¥ ì´ë ‡ê²Œ í•˜ë©´ í¸í•˜ë”ë¼"ë¡œ ì½”ë“œë¥¼ ì§°ë‹¤. Facade, DIP ê°™ì€ ìš©ì–´ë¥¼ ì•Œê³  ë‚˜ë‹ˆ ì˜¤íˆë ¤ ëª¨ë¥´ëŠ” ê²Œ ë” ë§ì•„ì¡Œë‹¤. íŠ¸ëœì­ì…˜ ì „íŒŒëŠ” ì–´ë–»ê²Œ í•´ì•¼ í•˜ì§€? ì´ë²¤íŠ¸ ê¸°ë°˜ìœ¼ë¡œ í™•ì¥í•˜ë©´? í…ŒìŠ¤íŠ¸ ê²½ê³„ëŠ” ì–´ë””ê¹Œì§€?

ê·¸ë˜ë„ ìš©ì–´ë¥¼ ì•Œê³  ë‚˜ë‹ˆ:

- ë‹¤ë¥¸ ê°œë°œìì™€ ì†Œí†µì´ ì‰¬ì›Œì¡Œë‹¤
- êµ¬ì¡°ë¥¼ ì„¤ëª…í•  ë•Œ ê·¼ê±°ê°€ ìƒê²¼ë‹¤
- "ì™œ ì´ë ‡ê²Œ í•˜ëŠ” ê±°ì•¼?"ì— ëŒ€ë‹µí•  ìˆ˜ ìˆê²Œ ëë‹¤

> ì´ë¯¸ ì•Œë˜ ê²ƒì— ì´ë¦„ì„ ë¶™ì´ë‹ˆ, ëª°ëë˜ ê²ƒë“¤ì´ ë³´ì´ê¸° ì‹œì‘í–ˆë‹¤.
{: .prompt-tip }

ë‹¤ìŒì— ëˆ„ê°€ "Facadeê°€ ë­ì•¼?"ë¼ê³  ë¬¼ìœ¼ë©´ ì´ë ‡ê²Œ ëŒ€ë‹µí•  ê²ƒ ê°™ë‹¤:

> "ì—¬ëŸ¬ Service ì¡°í•©í•´ì„œ Controllerì— ì „ë‹¬í•˜ëŠ” ê·¸ í´ë˜ìŠ¤ ìˆì–ì•„. ê·¸ê±°."
